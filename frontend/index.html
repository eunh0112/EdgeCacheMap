<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>EdgeCacheMap</title>
  <script type="text/javascript"
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8dc498e5a0513820fb29762cc5b64689&autoload=false" defer>
  </script>
  <style>
    #map {
      width: 100%;
      height: 600px;
    }

    .buttons {
      margin: 10px 0;
    }

    .buttons button {
      margin-right: 5px;
      padding: 6px 12px;
      border: none;
      background-color: #eee;
      cursor: pointer;
    }

    .buttons button.active {
      background-color: #007bff;
      color: white;
    }

    #info-box {
      margin-top: 12px;
      padding: 10px;
      border-top: 1px solid #ccc;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h2>ğŸ“ ì§€ë„ ê¸°ë°˜ ë§›ì§‘ ì¶”ì²œ ì‹œìŠ¤í…œ</h2>

  <div class="buttons">
    <button data-category="ì „ì²´" class="active">ì „ì²´</button>
    <button data-category="í•œì‹">í•œì‹</button>
    <button data-category="ì¤‘ì‹">ì¤‘ì‹</button>
    <button data-category="ì¼ì‹">ì¼ì‹</button>
    <button data-category="ë¶„ì‹">ë¶„ì‹</button>
    <button data-category="ì¹´í˜">ì¹´í˜</button>
  </div>

  <div id="map"></div>

  <div id="info-box">
    ğŸ½ï¸ ìŒì‹ì ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
  </div>

  <script src="markerData.js"></script>
  <script>
    // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜
    function getDistance(lat1, lng1, lat2, lng2) {
      return Math.sqrt(Math.pow(lat1 - lat2, 2) + Math.pow(lng1 - lng2, 2));
    }

    window.onload = function () {
      kakao.maps.load(function () {
        const mapContainer = document.getElementById('map');
        const mapOption = {
          center: new kakao.maps.LatLng(35.814, 127.148), // ì „ì£¼ ê¸°ì¤€
          level: 5
        };
        const map = new kakao.maps.Map(mapContainer, mapOption);
        const infoBox = document.getElementById("info-box");
        let allMarkers = [];

        // ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        navigator.geolocation.getCurrentPosition(function (position) {
          const userLat = position.coords.latitude;
          const userLng = position.coords.longitude;
          const userLocation = new kakao.maps.LatLng(userLat, userLng);
          map.setCenter(userLocation);

          const userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map,
            title: "ğŸ“ ë‚´ ìœ„ì¹˜"
          });

          // â­ ì¶”ì²œ ë§ˆì»¤ ì•„ì´ì½˜ ì„¤ì •
          const recommendIcon = new kakao.maps.MarkerImage(
            "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
            new kakao.maps.Size(24, 35)
          );

          // ê±°ë¦¬ ê³„ì‚°í•˜ì—¬ ê°€ì¥ ê°€ê¹Œìš´ 3ê³³ ì¶”ì²œ
          const distances = markerData.map(place => {
            const dist = getDistance(userLat, userLng, place.lat, place.lng);
            return { ...place, dist };
          });

          const top3 = distances.sort((a, b) => a.dist - b.dist).slice(0, 3);

          top3.forEach(place => {
            const pos = new kakao.maps.LatLng(place.lat, place.lng);
            const marker = new kakao.maps.Marker({
              position: pos,
              map: map,
              title: `â­ ì¶”ì²œ: ${place.name}`,
              image: recommendIcon
            });

            const infoWindow = new kakao.maps.InfoWindow({
              content: `<div style="padding:5px;">â­ ${place.name}</div>`
            });

            kakao.maps.event.addListener(marker, 'mouseover', function () {
              infoWindow.open(map, marker);
            });
            kakao.maps.event.addListener(marker, 'mouseout', function () {
              infoWindow.close();
            });

            kakao.maps.event.addListener(marker, 'click', function () {
              infoBox.innerHTML = `
                <h3>${place.name} â­ ${place.rating}</h3>
                <p>${place.description}</p>
              `;
            });
          });
        });

        // ê¸°ë³¸ ìŒì‹ì  ë§ˆì»¤ ë Œë”ë§
        markerData.forEach(function (place) {
          const marker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(place.lat, place.lng),
            map: map,
            title: place.name
          });

          const infoWindow = new kakao.maps.InfoWindow({
            content: `<div style="padding:5px;">${place.name}</div>`
          });

          kakao.maps.event.addListener(marker, 'mouseover', function () {
            infoWindow.open(map, marker);
          });
          kakao.maps.event.addListener(marker, 'mouseout', function () {
            infoWindow.close();
          });

          kakao.maps.event.addListener(marker, 'click', function () {
            infoBox.innerHTML = `
              <h3>${place.name} â­ ${place.rating}</h3>
              <p>${place.description}</p>
            `;
          });

          allMarkers.push({
            marker: marker,
            category: place.category
          });
        });

        // ë²„íŠ¼ í•„í„°
        const buttons = document.querySelectorAll(".buttons button");
        buttons.forEach(function (btn) {
          btn.addEventListener("click", function () {
            const category = this.getAttribute("data-category");

            buttons.forEach(b => b.classList.remove("active"));
            this.classList.add("active");

            allMarkers.forEach(obj => {
              if (category === "ì „ì²´" || obj.category === category) {
                obj.marker.setMap(map);
              } else {
                obj.marker.setMap(null);
              }
            });

            infoBox.innerHTML = "ğŸ½ï¸ ìŒì‹ì ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.";
          });
        });
      });
    };
  </script>
</body>
</html>
